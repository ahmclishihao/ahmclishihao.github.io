<!DOCTYPE html><html lang="zh_CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 2017-2-22-Spring（一） · 潜水的沙 -- Java 开发者</title><meta name="description" content="2017-2-22-Spring（一） - 潜水的沙"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://lshao.xyz/atom.xml" title="潜水的沙 -- Java 开发者"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">潜水的沙</a></li><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/ahmclishihao" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://blog.csdn.net/ahmclishihao" target="_blank" class="nav-list-link">CSDN</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">2017-2-22-Spring（一）</h1><div class="post-info">2017年2月22日</div><div class="post-content"><h2 id="Spring简介"><a href="#Spring简介" class="headerlink" title="Spring简介"></a>Spring简介</h2><p>Spring核心内容：bean、core、context、expression language</p>
<h2 id="BeanFactory和ApplicationContext的区别"><a href="#BeanFactory和ApplicationContext的区别" class="headerlink" title="BeanFactory和ApplicationContext的区别"></a>BeanFactory和ApplicationContext的区别</h2><p>1、加载问题<br>beanFactory会具备懒加载，只有在getBean的时候才会加载bean<br>applicationContext<strong><em>会立即加载配置文件中的所有bean</em></strong><br>2、applicationContext更强大<br>applicationContext可以进行国际化处理、事件传递、Bean自动装配、各种不同应用层的Context实现</p>
<h2 id="Bean文件详解"><a href="#Bean文件详解" class="headerlink" title="Bean文件详解"></a>Bean文件详解</h2><h3 id="Bean的生成方式"><a href="#Bean的生成方式" class="headerlink" title="Bean的生成方式"></a>Bean的生成方式</h3><p>1、默认构造<br>即普通的bean声明方式<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 默认构造 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.lsh.spring.b_instance.UserServiceImpl"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2、静态工厂构造<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 静态工厂 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.lsh.spring.b_instance.StaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getUserService"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3、实例工厂构造<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 实例工厂 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myFactory"</span> <span class="attr">class</span>=<span class="string">"com.lsh.spring.b_instance.InstanceFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService02"</span> <span class="attr">factory-bean</span>=<span class="string">"myFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getUserService"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="FactoryBean"><a href="#FactoryBean" class="headerlink" title="FactoryBean"></a>FactoryBean</h3><p>spring提供的工厂包装bean，实现factoryBean接口后，spring将加载首先加载该接口。</p>
<p>起到懒加载的作用。</p>
<p><strong><em>但是用这种方式后需要手动进行依赖注入。</em></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">&lt;!-- FactoryBean 一个实现了工厂的bean每次实例时，都是通过工厂创建，而不是直接的实例</span></span><br><span class="line"><span class="comment">   	spring内部调用其getObject方法获取实例</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.lsh.spring.c_factorybean.MyFactoryBean"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String xmlPath = <span class="string">"com/lsh/spring/c_factorybean/applicationContext.xml"</span>;</span><br><span class="line">		<span class="comment">// bean不会被立即加载UserService而是调用getBean时才会加载</span></span><br><span class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">				xmlPath);</span><br><span class="line">		IUserService userService = (IUserService) applicationContext</span><br><span class="line">				.getBean(<span class="string">"userService"</span>);</span><br><span class="line">		userService.serviceMethod();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="scope-作用域"><a href="#scope-作用域" class="headerlink" title="scope 作用域"></a>scope 作用域</h3><p>指定生成的bean是否为单例或者多例，默认为单例<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">""</span> <span class="attr">scope</span>=<span class="string">""</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>singleton : 单例<br>prototype : 多例</p>
<p>对于FactoryBean生产的bean需要在scope和isSingleton同时为单例的情况下才能生成单例的实例。</p>
<h3 id="lifecycle-生命周期"><a href="#lifecycle-生命周期" class="headerlink" title="lifecycle 生命周期"></a>lifecycle 生命周期</h3><p>xml 中 指定对应 init和destory方法，spring自动调用<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.lsh.spring.d_lifecycle.UserServiceImpl"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"destroy"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="BeanPostProcessor-回调"><a href="#BeanPostProcessor-回调" class="headerlink" title="BeanPostProcessor 回调"></a>BeanPostProcessor 回调</h3><p>BeanPostProcessor会在对象的init方法前后分别执行，开发者可以在此时对对象进行加工或者替换，但是<strong><em>对象销毁时仍然使用源对象的destroy方法</em></strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明一个BeanPostProcessor，提供给Spring回调 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.lsh.spring.d_lifecycle.MyBeanPostProcessor"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"MyBeanPostProcessor postProcessBefore "</span>);</span><br><span class="line">	<span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(<span class="keyword">final</span> Object bean,</span></span></span><br><span class="line"><span class="function"><span class="params">		String beanName)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"MyBeanPostProcessor postProcessAfter "</span>);</span><br><span class="line">	<span class="keyword">return</span> Proxy.newProxyInstance(</span><br><span class="line">			MyBeanPostProcessor.class.getClassLoader(),</span><br><span class="line">			UserServiceImpl.class.getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method,</span></span></span><br><span class="line"><span class="function"><span class="params">						Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">					String name = method.getName();</span><br><span class="line">					System.out.println(<span class="string">"开始调用"</span> + name + <span class="string">" 已经记录和处理"</span>);</span><br><span class="line">					Object methodResult = method.invoke(bean, args);</span><br><span class="line">					System.out.println(<span class="string">"结束调用"</span> + name + <span class="string">"已经记录和处理"</span>);</span><br><span class="line">					<span class="keyword">return</span> methodResult;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">com.lsh.spring.d_lifecycle.UserServiceImpl construct</span><br><span class="line">MyBeanPostProcessor postProcessBefore  ------------------------ &gt;&gt;&gt; postProcessor开始执行</span><br><span class="line">CopyOfMyBeanPostProcessor postProcessBefore </span><br><span class="line">com.lsh.spring.d_lifecycle.UserServiceImpl init</span><br><span class="line">MyBeanPostProcessor postProcessAfter </span><br><span class="line"></span><br><span class="line">CopyOfMyBeanPostProcessor postProcessAfter </span><br><span class="line">Copy 开始调用serviceMethod 已经记录和处理 ------------------------&gt;&gt;&gt;已经转为代理类</span><br><span class="line">开始调用serviceMethod 已经记录和处理</span><br><span class="line">com.lsh.spring.d_lifecycle.UserServiceImpl serviceMethod ------------------&gt;&gt;&gt;代理类中调用了源实例的方法</span><br><span class="line">结束调用serviceMethod已经记录和处理</span><br><span class="line">Copy 结束调用serviceMethod已经记录和处理</span><br><span class="line">com.lsh.spring.d_lifecycle.UserServiceImpl destroy ---------------&gt;&gt;&gt;调用了destroy</span><br></pre></td></tr></table></figure>
<h3 id="P命令空间"><a href="#P命令空间" class="headerlink" title="P命令空间"></a>P命令空间</h3><p>可以简化get/set方法，在参数注入时不用再去书写<property>&lt;/~&gt;类似的二级节点，类似android的配置文件。<br>使用时写上命名空间，如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">						   http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></property></p>
<h3 id="SpEL"><a href="#SpEL" class="headerlink" title="SpEL"></a>SpEL</h3><p>对<code>&lt;property&gt;</code>进行统一编程，所有的内容都使用value<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">"#&#123;表达式&#125;"</span>&gt;</span></span><br><span class="line">#&#123;123&#125;、#&#123;'jack'&#125; ： 数字、字符串</span><br><span class="line">#&#123;beanId&#125;	：另一个bean引用</span><br><span class="line">#&#123;beanId.propName&#125;	：操作数据</span><br><span class="line">#&#123;beanId.toString()&#125;	：执行方法</span><br><span class="line">#&#123;T(类).字段|方法&#125;	：静态方法或字段</span><br></pre></td></tr></table></figure></p>
<h2 id="spring常用注解"><a href="#spring常用注解" class="headerlink" title="spring常用注解"></a>spring常用注解</h2><p>使用注解时需要添加命名空间，并配置要扫描的包，如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">						   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">						   http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">						   http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 开启扫描 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.lsh.spring.e_di"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>常用替代bean配置的注解<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@component</span> <span class="comment">// 指定一个bean，以下三个为component的衍生注解</span></span><br><span class="line"><span class="meta">@Controller</span> <span class="comment">// 指明是一个control层</span></span><br><span class="line"><span class="meta">@Service</span> <span class="comment">// 指明是一个Service层</span></span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">// 指明是一个dao层</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span> <span class="comment">// 注入参数</span></span><br><span class="line"><span class="meta">@Autowired</span> <span class="comment">// 自动装配，可写在变量名上，也可写在set方法上</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE) <span class="comment">// 指明参数的作用域 单例(singleton)或者多例(prototype)</span></span><br></pre></td></tr></table></figure></p>
<p>即使，使用了注解setter方法也是不可避免的，需要添加setter方法才可以注入。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/01/14/2018-01-14-Bean Validation使用及原理/" class="prev">PREV</a><a href="/2017/02/13/2017-2-13-Hibernate/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2018 <a href="http://lshao.xyz">潜水的沙</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>