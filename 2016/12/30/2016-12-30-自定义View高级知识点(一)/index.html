<!DOCTYPE html><html lang="zh_CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 2016-12-30-自定义View高级知识点（一） · 潜水的沙 -- Java 开发者</title><meta name="description" content="2016-12-30-自定义View高级知识点（一） - 潜水的沙"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://lshao.xyz/atom.xml" title="潜水的沙 -- Java 开发者"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">潜水的沙</a></li><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/ahmclishihao" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://blog.csdn.net/ahmclishihao" target="_blank" class="nav-list-link">CSDN</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">2016-12-30-自定义View高级知识点（一）</h1><div class="post-info">2016年12月30日</div><div class="post-content"><p>自定义View中比较重要的一些知识点，本篇主要学习Canvas的一些基本使用。</p>
<a id="more"></a>
<h2 id="Canvas可以画的东西"><a href="#Canvas可以画的东西" class="headerlink" title="Canvas可以画的东西"></a>Canvas可以画的东西</h2><table>
<thead>
<tr>
<th>操作类型</th>
<th>相关API</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>绘制颜色</td>
<td>drawColor, drawRGB, drawARGB</td>
<td>使用单一颜色填充整个画布</td>
</tr>
<tr>
<td>绘制基本形状</td>
<td>drawPoint, drawPoints, drawLine, drawLines, drawRect, drawRoundRect, drawOval, drawCircle, drawArc</td>
<td>依次为 点、线、矩形、圆角矩形、椭圆、圆、圆弧</td>
</tr>
<tr>
<td>绘制图片</td>
<td>drawBitmap, drawPicture</td>
<td>绘制位图和图片</td>
</tr>
<tr>
<td>绘制文本</td>
<td>drawText,    drawPosText, drawTextOnPath</td>
<td>依次为 绘制文字、绘制文字时指定每个文字位置、根据路径绘制文字</td>
</tr>
<tr>
<td>绘制路径</td>
<td>drawPath</td>
<td>绘制路径，绘制贝塞尔曲线时也需要用到该函数</td>
</tr>
<tr>
<td>顶点操作</td>
<td>drawVertices, drawBitmapMesh</td>
<td>通过对顶点操作可以使图像形变，drawVertices直接对画布作用、 drawBitmapMesh只对绘制的Bitmap作用</td>
</tr>
<tr>
<td>画布剪裁</td>
<td>clipPath,    clipRect</td>
<td>设置画布的显示区域</td>
</tr>
<tr>
<td>画布快照</td>
<td>save, restore, saveLayerXxx, restoreToCount, getSaveCount</td>
<td>依次为 保存当前状态、 回滚到上一次保存的状态、 保存图层状态、 回滚到指定状态、 获取保存次数</td>
</tr>
<tr>
<td>画布变换</td>
<td>translate, scale, rotate, skew</td>
<td>依次为 位移、缩放、 旋转、错切</td>
</tr>
<tr>
<td>Matrix(矩阵)</td>
<td>getMatrix, setMatrix, concat</td>
<td>实际画布的位移，缩放等操作的都是图像矩阵Matrix，只不过Matrix比较难以理解和使用，故封装了一些常用的方法。</td>
</tr>
</tbody>
</table>
<h2 id="颜色混合模式-Alpha通道相关"><a href="#颜色混合模式-Alpha通道相关" class="headerlink" title="颜色混合模式(Alpha通道相关)"></a>颜色混合模式(Alpha通道相关)</h2><p>通过前面介绍我们知道颜色一般都是四个通道(ARGB)的，其中(RGB)控制的是颜色,而A(Alpha)控制的是透明度。</p>
<p>因为我们的显示屏是没法透明的，因此最终显示在屏幕上的颜色里可以认为没有Alpha通道。Alpha通道主要在两个图像混合的时候生效。</p>
<p>默认情况下，当一个颜色绘制到Canvas上时的混合模式是这样计算的：</p>
<p>(RGB通道) 最终颜色 = 绘制的颜色 + (1 - 绘制颜色的透明度) × Canvas上的原有颜色。</p>
<p>注意：</p>
<p>1.这里我们一般把每个通道的取值从0(ox00)到255(0xff)映射到0到1的浮点数表示。</p>
<p>2.这里等式右边的“绘制的颜色”、“Canvas上的原有颜色” 都是经过预乘了自己的Alpha通道的值。如绘制颜色：0x88ffffff，那么参与运算时的每个颜色通道的值不是1.0，而是(1.0 * 0.5333 = 0.5333)。 (其中0.5333 = 0x88/0xff)</p>
<p>使用这种方式的混合，就会造成后绘制的内容以半透明的方式叠在上面的视觉效果。</p>
<h2 id="Paint-setXfermode模式"><a href="#Paint-setXfermode模式" class="headerlink" title="Paint.setXfermode模式"></a>Paint.setXfermode模式</h2><p>下表是各个PorterDuff模式的混合计算公式：（D指原本在Canvas上的内容dst，S指绘制输入的内容src，a指alpha通道，c指RGB各个通道）,各种模式如下图所示。</p>
<p><img src="/img/2016-12-30-自定义View高级知识点(一)/PorterDuffMode.jpg" alt="porterDuff的模式" title="PorterDuffMode.jpg"></p>
<h2 id="onMeasure"><a href="#onMeasure" class="headerlink" title="onMeasure"></a>onMeasure</h2><p>真正进行测量的是 setMeasuredDimension<br>如果对View的宽高进行修改了，不要调用 super.onMeasure( widthMeasureSpec, heightMeasureSpec); 要调用 setMeasuredDimension( widthsize, heightsize); 这个函数。</p>
<h2 id="paint绘制图形"><a href="#paint绘制图形" class="headerlink" title="paint绘制图形"></a>paint绘制图形</h2><blockquote>
<p>一个要点：绘制的基本形状由Canvas确定，但绘制出来的颜色,具体效果则由Paint确定<br>STROKE                //描边<br>FILL                  //填充<br>FILL_AND_STROKE       //描边加填充</p>
</blockquote>
<p>1.圆角矩形</p>
<p>利用圆角矩形也可以绘制出椭圆</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RectF rectF = <span class="keyword">new</span> RectF(<span class="number">100</span>, <span class="number">100</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">mPaint.setColor(Color.BLACK);</span><br><span class="line">canvas.drawRect(rectF, mPaint);</span><br><span class="line">mPaint.setColor(Color.RED);</span><br><span class="line">canvas.drawRoundRect(rectF, <span class="number">100</span>, <span class="number">50</span>, mPaint);</span><br></pre></td></tr></table></figure>
<p>2.椭圆</p>
<p>椭圆绘制可以理解为做一个矩形的内切圆，如果这是一个正方形那么绘制出来的就是一个圆形</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RectF rectF = <span class="keyword">new</span> RectF(<span class="number">100</span>, <span class="number">100</span>, <span class="number">400</span>, <span class="number">300</span>);</span><br><span class="line">mPaint.setColor(Color.BLACK);</span><br><span class="line">canvas.drawOval(rectF, mPaint);</span><br></pre></td></tr></table></figure>
<p>3.扇形</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drawArc(RectF oval, <span class="function"><span class="keyword">float</span> <span class="title">startAngle</span><span class="params">(开始角度<span class="number">0</span><span class="number">-360</span>)</span>, <span class="keyword">float</span> <span class="title">sweepAngle</span><span class="params">(扫过角度<span class="number">0</span><span class="number">-360</span>)</span>, <span class="keyword">boolean</span> <span class="title">useCenter</span><span class="params">(是否连接圆心)</span>,Paint paint)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用中心</span></span><br><span class="line">RectF rectF = <span class="keyword">new</span> RectF(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">mPaint.setStyle(Paint.Style.FILL_AND_STROKE); </span><br><span class="line">mPaint.setColor(Color.GRAY);</span><br><span class="line">canvas.drawRect(rectF, mPaint);</span><br><span class="line">mPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">mPaint.setColor(Color.BLACK);</span><br><span class="line">canvas.drawArc(rectF, <span class="number">0</span>, <span class="number">90</span>, <span class="keyword">true</span>, mPaint);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不使用中心</span></span><br><span class="line">rectF = <span class="keyword">new</span> RectF(<span class="number">100</span>, <span class="number">300</span>, <span class="number">200</span>, <span class="number">400</span>);</span><br><span class="line">mPaint.setStyle(Paint.Style.FILL_AND_STROKE); <span class="comment">// 填充 并描边</span></span><br><span class="line">mPaint.setColor(Color.GRAY);</span><br><span class="line">canvas.drawRect(rectF, mPaint);</span><br><span class="line">mPaint.setStyle(Paint.Style.STROKE); <span class="comment">// 仅描边</span></span><br><span class="line">mPaint.setColor(Color.RED);</span><br><span class="line">canvas.drawArc(rectF, <span class="number">0</span>, -<span class="number">90</span>, <span class="keyword">false</span>, mPaint);</span><br></pre></td></tr></table></figure>
<p><img src="/img/2016-12-30-自定义View高级知识点(一)/drawArc.png" alt="扇形" title="drawArc.png"></p>
<p>4.画一个圆饼图</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PieChartView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Paint mPaint;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Percent&gt; mPercentList;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PieChartView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PieChartView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PieChartView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setStyle(Paint.Style.FILL_AND_STROKE);</span><br><span class="line">        mPaint.setStrokeCap(Paint.Cap.ROUND);</span><br><span class="line">        mPaint.setStrokeWidth(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        mPercentList = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        mPercentList.add(<span class="keyword">new</span> Percent(<span class="string">"1"</span>, <span class="number">0.4f</span>, Color.WHITE));</span><br><span class="line">        mPercentList.add(<span class="keyword">new</span> Percent(<span class="string">"2"</span>, <span class="number">0.4f</span>, Color.BLUE));</span><br><span class="line">        mPercentList.add(<span class="keyword">new</span> Percent(<span class="string">"3"</span>, <span class="number">0.2f</span>, Color.RED));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        RectF rectF = <span class="keyword">new</span> RectF(<span class="number">100</span>, <span class="number">100</span>, <span class="number">400</span>, <span class="number">400</span>);</span><br><span class="line">        canvas.drawOval(rectF, mPaint);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> surplus = <span class="number">1.0f</span>; <span class="comment">// 剩余的范围</span></span><br><span class="line">        <span class="keyword">float</span> startAngle = <span class="number">0</span>;</span><br><span class="line">        Percent percent;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = mPercentList.size(); i &lt; size; i++) &#123;</span><br><span class="line">            percent = mPercentList.get(i);</span><br><span class="line">            <span class="keyword">if</span> (percent.percent &lt;= surplus) &#123;</span><br><span class="line">                surplus -= percent.percent;</span><br><span class="line">                startAngle += percent.drawArc(mPaint, canvas, startAngle, rectF);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* 采用封装的思想</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Percent</span> </span>&#123;</span><br><span class="line">        String tag;</span><br><span class="line">        <span class="keyword">float</span> percent;</span><br><span class="line">        <span class="keyword">int</span> color;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Percent</span><span class="params">(String tag, <span class="keyword">float</span> percent, <span class="keyword">int</span> color)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.tag = tag;</span><br><span class="line">            <span class="keyword">this</span>.percent = percent;</span><br><span class="line">            <span class="keyword">this</span>.color = color;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 绘制 这个百分比</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> paint</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> canvas</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> startAngle</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> rectF</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> 返回绘制的角度大小</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">drawArc</span><span class="params">(Paint paint, Canvas canvas, <span class="keyword">float</span> startAngle, RectF rectF)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> oldColor = paint.getColor();</span><br><span class="line">            Paint.Style oldStyle = paint.getStyle();</span><br><span class="line"></span><br><span class="line">            paint.setColor(color);</span><br><span class="line">            paint.setStyle(Paint.Style.FILL);</span><br><span class="line"></span><br><span class="line">            canvas.drawArc(rectF, startAngle, <span class="number">360</span> * percent, <span class="keyword">true</span>, paint);</span><br><span class="line"></span><br><span class="line">            paint.setColor(oldColor);</span><br><span class="line">            paint.setStyle(oldStyle);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="number">360</span> * percent;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/2016-12-30-自定义View高级知识点(一)/pieChart.png" alt="圆饼图" title="pieChart.png"></p>
<h2 id="操作画布"><a href="#操作画布" class="headerlink" title="操作画布"></a>操作画布</h2><p>操作画布，操作的都是坐标系，是对当前坐标系进行移动、旋转、缩放、错切等操作</p>
<p>操作画布只会影响接下来的绘画，而不会影响之前已经绘画完成的图像</p>
<p>1.移动画布</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移动画布</span></span><br><span class="line">canvas.translate(getWidth() / <span class="number">2</span>, getHeight() / <span class="number">2</span>);</span><br><span class="line">canvas.drawCircle(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, mPaint);</span><br><span class="line">canvas.drawCircle(<span class="number">0</span>, <span class="number">0</span>, <span class="number">180</span>, mPaint);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转画布 并画线</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">36</span>; i++) &#123;</span><br><span class="line">	canvas.drawLine(<span class="number">0</span>, <span class="number">180</span>, <span class="number">0</span>, <span class="number">200</span>, mPaint);</span><br><span class="line">	canvas.rotate(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/2016-12-30-自定义View高级知识点(一)/circleView.png" alt="通过旋转画布实现两圆之间的连线" title="circleView.png"></p>
<p>2.旋转画布</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">float</span> degrees)</span> </span>&#123;</span><br><span class="line">    native_rotate(mNativeCanvasWrapper, degrees);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 相对某点缩放</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">float</span> degrees, <span class="keyword">float</span> px, <span class="keyword">float</span> py)</span> </span>&#123;</span><br><span class="line">    translate(px, py);</span><br><span class="line">    rotate(degrees);</span><br><span class="line">    translate(-px, -py);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看下图为相对某点进行缩放，图中的绘制顺序 1.红 2.黄 3.蓝 4.绿</p>
<p><img src="/img/2016-12-30-自定义View高级知识点(一)/scale.png" alt="相对某点缩放" title="scale.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">RectF rectF = <span class="keyword">new</span> RectF(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">mPaint.setColor(Color.RED);</span><br><span class="line">canvas.drawRect(rectF, mPaint);</span><br><span class="line"></span><br><span class="line">canvas.translate(<span class="number">200</span>,<span class="number">200</span>); <span class="comment">// 先将坐标系O移动到相对点P</span></span><br><span class="line">mPaint.setColor(Color.YELLOW);</span><br><span class="line">canvas.drawRect(rectF, mPaint);</span><br><span class="line"></span><br><span class="line">canvas.rotate(<span class="number">90</span>);<span class="comment">// 在相对点P处将坐标系O进行旋转 O--&gt;o P--&gt;p</span></span><br><span class="line">mPaint.setColor(Color.BLUE);</span><br><span class="line">canvas.drawRect(rectF, mPaint);</span><br><span class="line"></span><br><span class="line">canvas.translate(-<span class="number">200</span>,-<span class="number">200</span>);<span class="comment">// 将旋转后的坐标系o中的p与P对齐，让以后的操作都仍然相对于P点</span></span><br><span class="line">mPaint.setColor(Color.GREEN);</span><br><span class="line">canvas.drawRect(rectF, mPaint);</span><br></pre></td></tr></table></figure>
<p>3.缩放画布</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scale</span><span class="params">(<span class="keyword">float</span> sx, <span class="keyword">float</span> sy)</span> </span>&#123;</span><br><span class="line">    native_scale(mNativeCanvasWrapper, sx, sy);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 相对于某点进行缩放，其相对原理与相对某点旋转相同</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">scale</span><span class="params">(<span class="keyword">float</span> sx, <span class="keyword">float</span> sy, <span class="keyword">float</span> px, <span class="keyword">float</span> py)</span> </span>&#123;</span><br><span class="line">    translate(px, py);</span><br><span class="line">    scale(sx, sy);</span><br><span class="line">    translate(-px, -py);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>缩放比例(sx,sy)取值范围详解：</p>
<table>
<thead>
<tr>
<th>取值范围(n)</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[-∞, -1)</td>
<td>先根据缩放中心放大n倍，再根据中心轴进行翻转</td>
</tr>
<tr>
<td>-1</td>
<td>根据缩放中心轴进行翻转</td>
</tr>
<tr>
<td>(-1, 0)</td>
<td>先根据缩放中心缩小到n，再根据中心轴进行翻转</td>
</tr>
<tr>
<td>0</td>
<td>不会显示，若sx为0，则宽度为0，不会显示，sy同理</td>
</tr>
<tr>
<td>(0, 1)</td>
<td>根据缩放中心缩小到n</td>
</tr>
<tr>
<td>1</td>
<td>没有变化</td>
</tr>
<tr>
<td>(1, +∞)</td>
<td>根据缩放中心放大n倍</td>
</tr>
</tbody>
</table>
<p>负值时，坐标系方向取反，scale(1,-1)这个操作将使得坐标系变为数学中常用坐标系</p>
<p>旋转，缩放，位移三者应用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移动画布</span></span><br><span class="line">canvas.translate(getWidth() / <span class="number">2</span>, getHeight() / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">mPaint.setColor(Color.BLUE);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">	canvas.drawCircle(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, mPaint);</span><br><span class="line">	canvas.drawCircle(<span class="number">0</span>, <span class="number">0</span>, <span class="number">180</span>, mPaint);</span><br><span class="line">	canvas.rotate(j);</span><br><span class="line">	<span class="comment">// 旋转画布 并画线![enter description here][6]</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">float</span> i = j; i &lt;= <span class="number">360f</span>; i += <span class="number">10f</span>) &#123;</span><br><span class="line">		canvas.drawLine(<span class="number">0</span>, <span class="number">180</span>, <span class="number">0</span>, <span class="number">200</span>, mPaint);</span><br><span class="line">		canvas.rotate(<span class="number">10</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	canvas.scale(<span class="number">0.75f</span>, <span class="number">0.75f</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/2016-12-30-自定义View高级知识点(一)/scale_ratote_translate.png" alt="nothing" title="scale_ratote_translate.png"></p>
<p>4.错切（skew）</p>
<blockquote>
<p>错切是在某方向上，按照一定的比例对图形的每个点到某条平行于该方向的直线的有向距离做放缩得到的平面图形。(度娘)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">skew</span><span class="params">(<span class="keyword">float</span> sx, <span class="keyword">float</span> sy)</span> </span>&#123;</span><br><span class="line">    native_skew(mNativeCanvasWrapper, sx, sy);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">canvas.translate(getWidth()/<span class="number">2</span>,getHeight()/<span class="number">2</span>);</span><br><span class="line">RectF rectF = <span class="keyword">new</span> RectF(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">mPaint.setColor(Color.RED);</span><br><span class="line">canvas.drawRect(rectF, mPaint);</span><br><span class="line"></span><br><span class="line">canvas.skew(-<span class="number">1</span>,<span class="number">0</span>); <span class="comment">// 向左倾斜45度</span></span><br><span class="line">canvas.drawRect(rectF, mPaint);</span><br></pre></td></tr></table></figure></p>
<p>效果图：</p>
<p><img src="/img/2016-12-30-自定义View高级知识点(一)/skew.png" alt="错切" title="skew.png"></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/01/01/2017-1-1-自定义View高级知识点(二)/" class="prev">PREV</a><a href="/2016/12/24/2016-12-24-MD控件的使用/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://lshao.xyz">潜水的沙</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>